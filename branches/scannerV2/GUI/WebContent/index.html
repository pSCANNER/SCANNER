<!-- 
 * Copyright 2012 University of Southern California
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *    http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
-->

<!-- 
 * SCANNER UI
 * 
 * @author Serban Voinea
 * 
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta content="text/html;charset=UTF-8" http-equiv="Content-Type">
<title>Scanner</title>
<style type="text/css" title="currentStyle">
@import
	"resources/dojo-release-1.8.3/dojox/grid/resources/claroGrid.css";

#analyzeGridDiv, #slicesGridDiv, #projectsGridDiv {
	height: 20em;
}
</style>
<link rel="stylesheet" type="text/css" href="resources/jquery-ui.css">
<link rel="stylesheet" type="text/css"
	href="resources/css/demo_page.css">
<link rel="stylesheet" type="text/css"
	href="resources/css/demo_table.css">
<link rel="stylesheet" type="text/css"
	href="resources/jquery.treeview.css">
<link rel="stylesheet" type="text/css" href="resources/css/scanner.css">
<link rel="stylesheet" type="text/css"
	href="resources/dojo-release-1.8.3/dojo/../dijit/themes/claro/claro.css">
<script type="text/javascript" src="resources/jquery.js"></script>
<script type="text/javascript" src="resources/jquery-ui.js"></script>
<script type="text/javascript" src="resources/jquery.dataTables.js"></script>
<script type="text/javascript" src="resources/jquery.treeview.js"></script>
<script type="text/javascript" src="resources/d3.v3.js"></script>
<script type="text/javascript" src="resources/box.js"></script>
  <script type="text/javascript" src="resources/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript">
	dojoConfig = {
		async : true,
		parseOnLoad : true
	}
</script>
<script type="text/javascript"
	src='resources/dojo-release-1.8.3/dojo/dojo.js'></script>
<script type="text/javascript">
	require([ "dojo/parser", "dijit/layout/TabContainer",
			"dijit/layout/ContentPane" ]);
</script>
<script type="text/javascript" src="resources/scanner.js"></script>
</head>

<body>
	<div id="wrapper">
		<div id="tophead">
			<div id="login"></div>
		</div>
		<div id="content">
			<div id="welcome" style="display: none;">
				<div class="topMenu">
					<br/>
					<a class="link-style banner-text" href="javascript:submitLogout();" id="logoutButton" style="display: none;">Logout</a>
				</div>
				<br style="clear: both;" />
			</div>
			<div id="loginForm" style="display: none;">
				<h3>Welcome to SCANNER</h3>
				<p>You have reached a restricted access portal.</p>
				<p>Note that access control to data in SCANNER is delegated to
					the site that is providing the data. Furthermore, access to each
					data set is limited to study investigators as specified in an
					Institutional Review Board (IRB) approvals database, and the user
					must belong to one of the study sites and be authenticated by that
					site's enterprise authentication services.</p>
				<p>Notice: The HIPAA privacy regulations require health care organizations and their business 
					associates develop and follow procedures that ensure the confidentiality and security of protected 
					health information (PHI) when it is transferred, received, handled, or shared.
				</p>
				<p>Significant sanctions for misuse of data or inappropriate access of data will be imposed.</p>
				<br />
				<div>
					<input type="checkbox" id="acceptConditions" onclick="enableScanner()" >
					I understand and agree the <a target='_newtab2' href="http://www.hhs.gov/ocr/privacy/index.html" >Terms and Conditions</a> of using this site.
				</div>
				<br /><br />
				<table><tr><td valign="top">Select study to analize:</td><td> <select id="selectStudies"></select></td></tr>
				</table>
				<br/><br />
				<div><input type="button" id="continueButton" value="Continue" onclick="analyzeStudy();" disabled="disabled" ></div>
				<br/><br />
			</div>

			<div id="ui" style="visibility: hidden;">
				<div style="width: 100%; height: 300px;" class="claro" id="tabContainerWrapperDiv">
					<div id="queryTabContainer"
						data-dojo-type="dijit/layout/TabContainer" data-dojo-id="scannerTabContainer"
						style="width: 100%; height: 100%">
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Projects/Studies" onShow="showProjects();" onHide="hideProjects()">
							<div id="projectsListDiv">
								<ul>
									<li><a href="#myStudiesDiv"><span>My Studies</span></a></li>
									<li><a id="manageStudiesDivLink" href="#manageStudiesDiv"><span>Manage Studies</span></a></li>
									<li><a href="#newProjectDiv"><span>New Study</span></a></li>
								</ul>
								<div id="newProjectDiv" class="wizard_layer">
									<div id="createStudyDiv">
										<h1>New Study</h1>
										<div class="wizard_content">
											<table>
												<tr>
													<td>
														<table class="update_study">
															<tbody>
																<tr>
																	<td class="tag">Title:</td>
																	<td><input type="text" id="studyTitleInput"></td>
																	<td class="tag">IRB:</td>
																	<td><input type="text" id="createStudyIRBInput"></td>
																</tr>
																<tr>
																	<td class="tag">Principal Investigator:</td>
																	<td><select id="createStudyPrincipalInvestigator"></select></td>
																	<td class="tag">Study Status Type:</td>
																	<td>
																		<select id="createStudyStatusType">
																			<option value="1">defined</option>
																		</select>
																	</td>
																</tr>
															</tbody>
														</table>
													</td>
												</tr>
												<tr>
													<td class="tag">
														<input type="button" id="createStudyButton" value="Create Study" onclick="createStudy()" disabled="disabled">
													</td>
												</tr>
											</table>
										</div>
									</div>
								</div>
								<div id="manageStudiesDiv" class="wizard_layer">
									<h2 id="manageStudyH2">Manage Research Study</h2>
									<div id="updateStudyDiv">
										<p class="wizard_heading">Enter Basic Information</p>
										<div class="wizard_content">
											<table>
												<tr>
													<td>
														<table class="update_study">
															<tbody>
																<tr>
																	<td class="tag">Title:</td>
																	<td><input type="text" id="projectTitle"></td>
																	<td class="tag">Start Date:</td>
																	<td><input type="text" id="projectStartDate" class="datepicker"></td>
																</tr>
																<tr>
																	<td class="tag">Description:</td>
																	<td><input type="text" id="projectDescription" size="50"></td>
																	<td class="tag">End Date:</td>
																	<td><input type="text" id="projectEndDate" class="datepicker"></td>
																</tr>
															</tbody>
														</table>
													</td>
												</tr>
												<tr>
													<td class="tag">
														<input type="button" value="Update Study" onclick="updateStudy()">
													</td>
												</tr>
											</table>
										</div>
										<p class="wizard_heading">Manage Study Staff</p>
										<div class="wizard_content">
											<table class="manageStudyStaffTable">
												<tbody id="manageStudyStaffTbody"></tbody>
											</table>
											<br />
											<table>
												<tr>
													<td>
														<table class="add_staff">
															<tbody id="addStaffTable">
																<tr>
																	<td>Add:</td>
																	<td>
																		<select id="staffNames">
																		</select> 
																	</td>
																	<td>as</td>
																	<td>
																		<select id="staffRoles">
																		</select> 
																	</td>
																	<td>in affilation with</td>
																	<td>
																		<select id="studySites">
																		</select> 
																	</td>
																</tr>
															</tbody>
														</table>
													</td>
													<td>
														<button id="addStaffButton" onclick="addStaff();">Add Staff</button>
													</td>
												</tr>
											</table>
										</div>
										<p class="wizard_heading">Manage Study Protocols</p>
										<div class="wizard_content">
											<table id="manageStudyProtocols" class="manageStudyProtocols">
												<thead>
													<tr>
														<th class="protocol_border">Method</th>
														<th class="protocol_border">Site</th>
														<th class="protocol_border">Data Set</th>
														<th class="protocol_border">URL</th>
														<th class="protocol_border">Node</th>
														<th class="protocol_border">Result Transfer Policy</th>
														<th></th>
														<th></th>
													</tr>
												</thead>
												<tbody id="manageStudyProtocolsTbody"></tbody>
											</table>
											<br />
											<div id="add_protocol_div">
												<table>
													<tr>
														<td>
															<table class="add_protocol">
																<tbody id="addProtocolTable">
																	<tr>
																		<td>
																			<select id="modelNames">
																			</select> 
																		</td>
																		<td>
																			<select id="datasetNames">
																			</select> 
																		</td>
																		<td>
																			<select id="datasetInstances">
																			</select> 
																		</td>
																		<td>
																			<select id="studySendOptions">
																			</select> 
																		</td>
																	</tr>
																</tbody>
															</table>
														</td>
														<td>
															<button id="addProtocolButton" onclick="addProtocol();">Add Protocol</button>
														</td>
													</tr>
												</table>
											</div>
											<div id="add_instance_div">
												<table>
													<tr>
														<td>
															<table class="add_instance">
																<tbody id="addInstanceTable">
																	<tr>
																		<td>Data Set Instance Name:
																			<br />
																			<input type="text" id="instanceName">
																		</td>
																		<td>
																			<select id="nodeNames">
																			</select> 
																		</td>
																		<td>with Data Source:
																			<br />
																			<input type="text" id="instanceDataSource">
																		</td>
																		<td>and Description:
																			<br />
																			<input type="text" id="instanceDescription">
																		</td>
																	</tr>
																</tbody>
															</table>
														</td>
													</tr>
													<tr>
														<td class="tag">
															<input type="button" value="Cancel" onclick="cancelInstance()">
															<input type="button" id="addInstanceButton" value="Add Instance" onclick="addInstance()">
														</td>
													</tr>
												</table>
											</div>
										</div>
										<p class="wizard_heading">Manage Documentation</p>
										<div class="wizard_content">
											<div class="placeHolder">
												<br /><br /><br />
												Manageament Area Here for IRBs DUAs and BAAs
												<br /><br /><br />
											</div>
										</div>
									</div>
								</div>
								<div id="myStudiesDiv" class="wizard_layer">
									<h1>My Studies</h1>
									<div id="lisyMyStudiesDiv">
									</div>
								</div>
							</div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Prep to Research" onShow="hideQuery();">
							<div id="prepToResearchDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane" title="Analyze"
							data-dojo-props="selected:true" onShow="showQuery();">
							<div class="topMenu" id="studyName"></div>
							<br style="clear: both;" />
							<table>
								<tbody>
									<tr>
										<td valign="top" style="width: 60%;">
											<table>
												<tbody>
													<tr>
														<td>Datasets</td>
														<td>Sites</td>
														<td>Libraries</td>
														<td>Methods</td>
													</tr>
													<tr>
														<td valign="top"><select id="selectDatasets"></select>
														</td>
														<td valign="top"><select id="selectSites"></select>
														</td>
														<td valign="top"><select id="selectLibraries"></select>
														</td>
														<td valign="top"><select id="selectMethods"></select>
														</td>
													</tr>
												</tbody>
											</table>
											<br/><br/>
											<span class="double_bottom_border"> Sites Status </span> <br/><br/> 
											<div>Refreshing every 5 minutes. Last refresh was performed 
												<span id="refreshTimestamp"></span>.
											</div>
											<br/>
											<table>
												<tbody id="sitesStatusBody">
												</tbody>
											</table>
										</td>
										<td valign="top" style="width: 35%;">
											<div id="queryHelp">
												<span class="double_bottom_border"> Quick Help </span> <br/> <br/>
												<span>Select dataset, site(s), method and library on
													the left</span><br/> <br />
												<span id="datasetHelp"></span> <br/> <br/> 
												<span id="libraryHelp"></span> <br/> <br/>
												<span id="methodHelp"></span> 
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="History" onShow="hideQuery();" id="historyPanel">
							<div id="analyzeGridDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Data Sets" onShow="hideQuery();">
							<div id="dataSetsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Tasks and Notifications" onShow="hideQuery();">
							<div id="tasksAndNotificationsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Network Information" onShow="hideQuery();">
							<div id="networkInformationDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Administration" onShow="hideQuery();">
							<div id="administrationDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Products" onShow="hideQuery();">
							<div id="productsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane" title="Profile" onShow="hideQuery();">
							<div id="profileDiv" class="method_border method_margin">
								<table id="profileTable">
									<tr>
										<td>Identity</td>
										<td id="profileIdentity"></td>
										<td id="profileIdentityDescription"></td>
									</tr>
									<tr>
										<td>Role</td>
										<td id="profileRole"></td>
										<td rowspan="3" id="profileRoleDescription"></td>
									</tr>
									<tr>
										<td class="nowrap">Study count</td>
										<td id="profileStudyCount"></td>
									</tr>
									<tr>
										<td class="nowrap">Query count</td>
										<td id="profileQueryCount"></td>
									</tr>
									<tr>
										<td class="nowrap">Privacy budget</td>
										<td id="profilePrivacyBudget"></td>
										<td rowspan="2" id="profilePrivacyBudgetDescription"></td>
									</tr>
									<tr>
										<td class="nowrap">Last activity</td>
										<td class="nowrap" id="profileLastActivity"></td>
									</tr>
								</table>
							</div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Contacts" onShow="hideQuery();">
							<div id="contactsDiv"></div>
						</div>
					</div>
				</div>

				<div id="paramsWrapperDiv">
					<p id="paramsTitle"></p>
					<table id="paramsTable">
						<tbody>
							<tr>
								<td valign="top">
									<div id="paramsDiv" class="method_border" style="display: none;">
										<div id="paramsDivContent" class="method_margin"></div>
										<div id="ajaxSpinnerContainer">
											<img src="resources/images/ajax-loader.gif" id="ajaxSpinnerImage"
												title="Processing..." alt="Spinner" />
										</div>
										<p style="display:none;">
											<input type="checkbox" id="asyncCheckBox" checked="checked" >Asynchronous (Debug only)
										</p>
										<input type="button" value="Query" id="submitQueryButton" onclick="submitQuery('queryDivContent', null, -1, null);"
											class="method_margin"> <input type="button" value="Clear"
											onclick="renderAvailableStudies();"> <br />
										<br />
									</div>
								</td>
								<td valign="top">
									<div id="statusQueryWrapperDiv" class="method_border method_margin" style="display: none;">
										<div id="statusQueryDiv" class="method_margin" style="display: none;" >
											<h2>Status</h2>
											<div id="statusQueryDivContent">
											</div>
										</div>
									</div>
									<div id="queryDiv" style="display: none;" >
										<h2 id="queryTitle">Query Results</h2>
										<img src="resources/images/expand.jpg" id="expandQueryResultsArrow"
											alt="Expand" onclick="expandQueryResults('queryDivContent', 'expandQueryResultsArrow', 'collapseQueryResultsArrow');"/>
										<img src="resources/images/collapse.jpg" id="collapseQueryResultsArrow"
											alt="Collapse"  onclick="collapseQueryResults('queryDivContent', 'expandQueryResultsArrow', 'collapseQueryResultsArrow');" style="display: none;"/>
										<div id="queryDivContent" style="display: none;">
										</div>
										<br/><br/><br/>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div id="authorizationWrapperDiv" style="display: none;" >
				<br/><br/><br/>
				<div id="authorizationDiv">
					<h2>Authorization Required</h2>
					<div id="authorizationContent">
						You have no authorization to see any studies. Please contact us at 
						<a class="mailto banner-text" href="mailto:sdsc-scanner@ucsd.edu">sdsc-scanner@ucsd.edu</a> 
						if you have questions or need help.
					</div>
					<br/><br/><br/>
				</div>
			</div>
		</div>
		<div id="statusReplayWrapperDiv">
			<div id="statusReplayDiv" style="display: none;" >
				<h2>Status</h2>
				<div id="statusReplayDivContent">
				</div>
			</div>
		</div>
		<div id="replayDivWrapper">
			<br style="clear: left;" />
			<div id="ajaxAnalyzeSpinnerContainer">
				<img src="resources/images/ajax-loader.gif" id="ajaxAnalyzeSpinnerImage"
					title="Processing..." alt="Spinner" />
			</div>
			<div id="replayDiv" style="display: none;" >
				<h2 id="replayTitle">Query Results</h2>
				<img src="resources/images/expand.jpg" id="expandResults"
					alt="Expand" onclick="expandQueryResults('replayDivContent', 'expandResults', 'collapseResults');"/>
				<img src="resources/images/collapse.jpg" id="collapseResults"
					alt="Collapse"  onclick="collapseQueryResults('replayDivContent', 'expandResults', 'collapseResults');" style="display: none;"/>
				<div id="replayDivContent" style="display: none;">
				</div>
				<br/><br/><br/>
			</div>
		</div>


		<div id="footer" style="display: none; float: left;">SCANNER is
			supported by the Agency for Healthcare Research and Quality (AHRQ)
			through the American Recovery &amp; Reinvestment Act of 2009, Grant
			R01 HS019913.
		</div>
		<script type="text/javascript">
		$(document).ready(function () { 
			initScanner();
		});
		</script>
	</div>
	<div id="TipBox"
		style="display: none; position: absolute; font-size: 12px; font-weight: bold; font-family: verdana; border: #72B0E6 solid 1px; padding: 15px; color: #1A80DB; background-color: #FFFFFF; max-width:500px;">
	</div> <!-- END FLY OVER DIV --> 
	<div id="Alert_Error_Dialog" style="display: none">
		<div id="errorMessage"></div>
	</div>
</body>
</html>

