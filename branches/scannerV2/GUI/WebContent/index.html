<!-- 
 * Copyright 2012 University of Southern California
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *    http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
-->

<!-- 
 * SCANNER UI
 * 
 * @author Serban Voinea
 * 
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta content="text/html;charset=UTF-8" http-equiv="Content-Type">
<title>Scanner</title>
<style type="text/css" title="currentStyle">
@import
	"resources/dojo-release-1.8.3/dojox/grid/resources/claroGrid.css";

#analyzeGridDiv, #slicesGridDiv, #projectsGridDiv {
	height: 20em;
}
</style>
<link rel="stylesheet" type="text/css" href="resources/jquery-ui.css">
<link rel="stylesheet" type="text/css"
	href="resources/css/demo_page.css">
<link rel="stylesheet" type="text/css"
	href="resources/css/demo_table.css">
<link rel="stylesheet" type="text/css"
	href="resources/jquery.treeview.css">
<link rel="stylesheet" type="text/css" href="resources/css/scanner.css">
<link rel="stylesheet" type="text/css"
	href="resources/dojo-release-1.8.3/dojo/../dijit/themes/claro/claro.css">
<script type="text/javascript" src="resources/jquery.js"></script>
<script type="text/javascript" src="resources/jquery-ui.js"></script>
<script type="text/javascript" src="resources/jquery.dataTables.js"></script>
<script type="text/javascript" src="resources/jquery.treeview.js"></script>
<script type="text/javascript" src="resources/d3.v3.js"></script>
<script type="text/javascript" src="resources/box.js"></script>
<script type="text/javascript">
	dojoConfig = {
		async : true,
		parseOnLoad : true
	}
</script>
<script type="text/javascript"
	src='resources/dojo-release-1.8.3/dojo/dojo.js'></script>
<script type="text/javascript">
	require([ "dojo/parser", "dijit/layout/TabContainer",
			"dijit/layout/ContentPane" ]);
</script>
<script type="text/javascript" src="resources/scanner.js"></script>
</head>

<body>
	<div id="wrapper">
		<div id="tophead">
			<div id="login"></div>
		</div>
		<div id="content">
			<div id="welcome" style="display: none;">
				<div class="topMenu">
					<br/>
					<a class="link-style banner-text" href="javascript:submitLogout();" id="logoutButton" style="display: none;">Logout</a>
				</div>
				<br style="clear: both;" />
				<h3>Welcome to SCANNER</h3>
				<p>You have reached a restricted access portal.</p>
				<p>Note that access control to data in SCANNER is delegated to
					the site that is providing the data. Furthermore, access to each
					data set is limited to study investigators as specified in an
					Institutional Review Board (IRB) approvals database, and the user
					must belong to one of the study sites and be authenticated by that
					site's enterprise authentication services.</p>
			</div>
			<div id="loginForm" style="display: none;">
				<p>Notice: The HIPAA privacy regulations require health care organizations and their business 
					associates develop and follow procedures that ensure the confidentiality and security of protected 
					health information (PHI) when it is transferred, received, handled, or shared.
				</p>
				<p>Significant sanctions for misuse of data or inappropriate access of data will be imposed.</p>
				<br />
				<div>
					<input type="checkbox" id="acceptConditions" onclick="enableScanner()" >
					I understand and agree the <a target='_newtab2' href="http://www.hhs.gov/ocr/privacy/index.html" >Terms and Conditions</a> of using this site.
				</div>
				<br /><br />
				<div><input type="button" id="continueButton" value="Continue" onclick="submitLogin();"disabled="disabled" ></div>
				<br/><br />
			</div>

			<div id="ui" style="visibility: hidden;">
				<div style="width: 100%; height: 300px;" class="claro">
					<div id="queryTabContainer"
						data-dojo-type="dijit/layout/TabContainer" data-dojo-id="scannerTabContainer"
						style="width: 100%; height: 100%">
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Projects/Studies" onShow="showProjects();">
							<div id="projectsListDiv">
								<div id="projectsMenu">
									<a class="link-style banner-text" href="javascript:newProject();">New Project</a>&nbsp;&nbsp;
									<a class="link-style banner-text" href="javascript:manageStudies();">Manage Studies</a>&nbsp;&nbsp;
									<a class="link-style banner-text" href="javascript:manageDatasets();">Manage Datasets</a>&nbsp;&nbsp;
									<a class="link-style banner-text" href="javascript:manageSites();">Manage Sites</a>&nbsp;&nbsp;
									<br/><br/>
								</div>
								<div id="projectsList">
									<div id="projectsGridDiv">
									</div>
								</div>
							</div>
							<div id="newProjectDiv" style="display: none;">
								<br/>
								<table id="newProjectTable" class="attributes_list">
									<thead>
										<tr class="attribute_heading">
											<th class="attribute_value">Attribute</th>
											<th class="attribute_value">Value</th>
										</tr>
									</thead>
									<tbody>
										<tr class="attribute uneven"><td>Project Title</td><td class="attribute"><input type="text" id="projectTitle"></td></tr>
										<tr class="attribute"><td>Project Description</td><td class="attribute"><input type="text" id="projectDescription"></td></tr>
										<tr class="attribute uneven"><td>Principal Investigator</td><td class="attribute"><select id="selectProjectInvestigator"></select></td></tr>
									</tbody>
								</table>
								<br/>
								<div id="newProjectButtonDiv" style="text-align: right;">
									<input type="button" value="Cancel" onclick="showProjects()">
									<input type="button" value="Next" onclick="showProjectSlices()">
									<input type="button" value="Finish" onclick="saveProject()">
								</div>
							</div>
							<div id="projectSlices" style="display: none;">
								<div id="slicesGridDiv">
								</div>
								<br/>
								<div id="newSlicesButtonDiv" style="text-align: right;">
									<input type="button" value="Cancel" onclick="showProjects()">
									<input type="button" value="New Slice" onclick="newSlice()">
									<input type="button" value="Previous" onclick="previousProject()">
									<input type="button" value="Finish" onclick="saveProject()">
								</div>
							</div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Prep to Research" onShow="hideQuery();">
							<div id="prepToResearchDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane" title="Analyze"
							data-dojo-props="selected:true" onShow="showQuery();">
							<table>
								<tbody>
									<tr>
										<td valign="top" style="width: 60%;">
											<table>
												<tbody>
													<tr>
														<td>Studies</td>
														<td>Datasets</td>
														<td>Libraries</td>
														<td>Methods</td>
														<td>Sites</td>
													</tr>
													<tr>
														<td valign="top"><select id="selectStudies"></select>
														</td>
														<td valign="top"><select id="selectDatasets"></select>
														</td>
														<td valign="top"><select id="selectLibraries"></select>
														</td>
														<td valign="top"><select id="selectMethods"></select>
														</td>
														<td valign="top"><select id="selectSites"></select>
														</td>
													</tr>
												</tbody>
											</table>
											<br/><br/>
											<span class="double_bottom_border"> Sites Status </span> <br/><br/> 
											<div>Refreshing every 5 minutes. Last refresh was performed 
												<span id="refreshTimestamp"></span>.
											</div>
											<br/>
											<table>
												<tbody id="sitesStatusBody">
												</tbody>
											</table>
										</td>
										<td valign="top" style="width: 35%;">
											<div id="queryHelp">
												<span class="double_bottom_border"> Quick Help </span> <br /> <br />
												<span>Select study, dataset, library, method and sites on
													the left</span> <br /> <br /> <span id="studyHelp"></span> <br /> <br />
												<span id="datasetHelp"></span> <br /> <br /> <span
													id="libraryHelp"></span> <br /> <br /> <span id="methodHelp"></span>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Query Results" onShow="hideQuery();" id="analyzePane">
							<div id="analyzeGridDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Data Sets" onShow="hideQuery();">
							<div id="dataSetsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Tasks and Notifications" onShow="hideQuery();">
							<div id="tasksAndNotificationsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Network Information" onShow="hideQuery();">
							<div id="networkInformationDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Administration" onShow="hideQuery();">
							<div id="administrationDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Products" onShow="hideQuery();">
							<div id="productsDiv"></div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane" title="Profile" onShow="hideQuery();">
							<div id="profileDiv" class="method_border method_margin">
								<table id="profileTable">
									<tr>
										<td>Identity</td>
										<td id="profileIdentity"></td>
										<td id="profileIdentityDescription"></td>
									</tr>
									<tr>
										<td>Role</td>
										<td id="profileRole"></td>
										<td rowspan="3" id="profileRoleDescription"></td>
									</tr>
									<tr>
										<td class="nowrap">Study count</td>
										<td id="profileStudyCount"></td>
									</tr>
									<tr>
										<td class="nowrap">Query count</td>
										<td id="profileQueryCount"></td>
									</tr>
									<tr>
										<td class="nowrap">Privacy budget</td>
										<td id="profilePrivacyBudget"></td>
										<td rowspan="2" id="profilePrivacyBudgetDescription"></td>
									</tr>
									<tr>
										<td class="nowrap">Last activity</td>
										<td class="nowrap" id="profileLastActivity"></td>
									</tr>
								</table>
							</div>
						</div>
						<div data-dojo-type="dijit/layout/ContentPane"
							title="Contacts" onShow="hideQuery();">
							<div id="contactsDiv"></div>
						</div>
					</div>
				</div>

				<div id="paramsWrapperDiv" style="width: 100%;">
					<p id="paramsTitle"></p>
					<table id="paramsTable" style="width: 100%;">
						<tbody>
							<tr>
								<td valign="top"style="width: 60%;">
									<div id="paramsDiv" class="method_border" style="width: 100%; display: none;">
										<div id="paramsDivContent" class="method_margin"></div>
										<div id="ajaxSpinnerContainer">
											<img src="resources/images/ajax-loader.gif" id="ajaxSpinnerImage"
												title="Processing..." alt="Spinner" />
										</div>
										<p style="display:none;">
											<input type="checkbox" id="asyncCheckBox" checked="checked" >Asynchronous (Debug only)
										</p>
										<input type="button" value="Query" onclick="submitQuery('replayDivContent', null, -1, null);"
											class="method_margin"> <input type="button" value="Clear"
											onclick="renderAvailableStudies();"> <br />
										<br />
									</div>
								</td>
								<td style="width: 35%;" valign="top">
									<div id="paramsHelpDiv">
										<span class="double_bottom_border"> Quick Help </span>
										<br/><br/>
										<div id="paramsHelp"></div>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div id="authorizationWrapperDiv" style="display: none;" >
				<br/><br/><br/>
				<div id="authorizationDiv">
					<h2>Authorization Required</h2>
					<div id="authorizationContent">
						You have no authorization to see any studies. Please contact us at 
						<a class="mailto banner-text" href="mailto:sdsc-scanner@ucsd.edu">sdsc-scanner@ucsd.edu</a> 
						if you have questions or need help.
					</div>
					<br/><br/><br/>
				</div>
			</div>
		</div>
		<div id="statusReplayWrapperDiv">
			<div id="statusReplayDiv" style="display: none;" >
				<h2>Status</h2>
				<div id="statusReplayDivContent">
				</div>
			</div>
		</div>
		<div id="replayDivWrapper">
			<br style="clear: left;" />
			<div id="ajaxAnalyzeSpinnerContainer">
				<img src="resources/images/ajax-loader.gif" id="ajaxAnalyzeSpinnerImage"
					title="Processing..." alt="Spinner" />
			</div>
			<div id="replayDiv" style="display: none;" >
				<h2 id="replayTitle">Query Results</h2>
				<div id="replayDivContent">
				</div>
				<br/><br/><br/>
			</div>
		</div>


		<div id="footer" style="display: none; float: left;">SCANNER is
			supported by the Agency for Healthcare Research and Quality (AHRQ)
			through the American Recovery &amp; Reinvestment Act of 2009, Grant
			R01 HS019913.
		</div>
		<script type="text/javascript">
		$(document).ready(function () { 
			initScanner();
		});
		</script>
	</div>
	<div id="TipBox"
		style="display: none; position: absolute; font-size: 12px; font-weight: bold; font-family: verdana; border: #72B0E6 solid 1px; padding: 15px; color: #1A80DB; background-color: #FFFFFF; max-width:500px;">
	</div> <!-- END FLY OVER DIV --> 
	<div id="Alert_Error_Dialog" style="display: none">
		<div id="errorMessage"></div>
	</div>
</body>
</html>

